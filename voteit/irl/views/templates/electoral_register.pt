<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      metal:use-macro="load: ${api.template_dir}content.pt"
	  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
	  i18n:domain="voteit.irl">
<body>
<h1 metal:fill-slot="page_heading">Electoral Register</h1>
<div metal:fill-slot="content" class="content_wrapper">
	<p>
		<a href="${request.resource_url(context, 'view_eligible_voters')}" i18n:translate="">List of eligible voters</a>
	</p>
	<p i18n:translate="">
		To get on the list, the user must at some time have had the right to vote in the 
		meeting. Moderator can add and remove people from the list.
	</p>
	<tal:open_register tal:condition="api.context_has_permission('Moderate Meeting', context)">
		<h2 i18n:translate="">Adjust the electoral register</h2>
		<p i18n:translate="adjust_the_electoral_register_description">
			
		</p>
		<p>
			<a class="buttonize" 
			   href="${request.resource_url(context, 'clear_electoral_register')}" 
			   tal:condition="register.register_closed" 
			   i18n:translate="">
			   		Open</a>
			<a class="buttonize" 
			   href="${request.resource_url(context, 'close_electoral_register')}" 
			   tal:condition="not register.register_closed" 
			   i18n:translate="">
			   		Close</a>
		</p>
	</tal:open_register>
	<tal:update_voteing_rights condition="api.context_has_permission('Moderate Meeting', context)">
		<h2 i18n:translate="">Update voting rights based on latest electoral register</h2>
		<p i18n:translate="update_voting_rights_description">
			Update voting rights changes voting rights to only include those who are entitled to 
			vote on the basis of latest electoral register and selected electorial register method below.
		</p>
		<div tal:content="structure method_form">Method Form</div>
	</tal:update_voteing_rights>
    <h2 i18n:translate="">Electoral registers</h2>
    <table class="electoral-register listing">
    	<thead>
    		<tr>
    			<th class="heading" i18n:translate="">
    				Time
    			</th>
    			<th class="heading" i18n:translate="">
    				Number of users
    			</th>
    		</tr>
    	</thead>
    	<tbody>
		    <tal:iterate repeat="id sorted(archive.keys(), key=int, reverse=True)">
		        <tr tal:attributes="class repeat.id.odd and 'odd' or '';">
		            <td><a href="${request.resource_url(context, 'view_electoral_register', query={'id': id})}">
		            	${api.dt_util.dt_format(archive[id]['time'])}</a></td>
		            <td><a href="${request.resource_url(context, 'view_electoral_register', query={'id': id})}">
		            	${len(archive[id]['userids'])}</a></td>
		        </tr>
		    </tal:iterate>
	    </tbody>
    </table>
    <h2 i18n:translate="">View difference between selected electoral registers</h2>
    <div tal:condition="diff_form and len(archive) > 1" tal:replace="structure diff_form">Diff form</div>
</div>
</body>
</html>
